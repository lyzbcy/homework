# 基于知识图谱的医药问答系统 - 详细使用指南

## 📋 准备工作

### 确认项目位置
你的项目位于：
```
E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG
```

### 确认Python已安装
1. 按 `Win + R` 键，输入 `cmd`，按回车
2. 在命令行中输入：`python --version`
3. 如果显示版本号（如 `Python 3.8.0`），说明已安装
4. 如果没有，请先安装Python 3.6或更高版本

---

## 🚀 第一步：打开命令行窗口

### Windows系统操作步骤：

**方法一：从项目文件夹打开**
1. 打开文件资源管理器（按 `Win + E`）
2. 导航到项目文件夹：
   ```
   E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG
   ```
3. 在文件夹空白处，按住 `Shift` 键，然后右键点击
4. 选择 **"在此处打开 PowerShell 窗口"** 或 **"在此处打开命令窗口"**

**方法二：手动打开命令提示符**
1. 按 `Win + R` 键
2. 输入 `cmd` 或 `powershell`
3. 按回车
4. 在命令行中输入以下命令切换到项目目录：
   ```powershell
   cd "E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG"
   ```
5. 按回车

**验证当前目录：**
在命令行中输入：
```powershell
cd
```
或
```powershell
pwd
```
应该显示：
```
E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG
```

---

## 📦 第二步：安装Python依赖包

### 操作步骤：

1. **确认你在正确的目录**
   - 在命令行中，你应该看到类似这样的提示：
     ```
     PS E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG>
     ```
   - 如果不是，请使用 `cd` 命令切换到上述目录

2. **输入安装命令**
   - 在命令行中输入（直接复制粘贴即可）：
     ```powershell
     pip install -r requirements.txt
     ```
   - 按回车键执行

3. **等待安装完成**
   - 你会看到类似这样的输出：
     ```
     Collecting py2neo>=2021.2.3
       Downloading py2neo-2021.2.3...
     Collecting pyahocorasick>=2.0.0
       Downloading pyahocorasick-2.0.0...
     ...
     Successfully installed py2neo-2021.2.3 pyahocorasick-2.0.0 pymongo-4.0.0 lxml-4.6.0
     ```
   - 如果看到 `Successfully installed`，说明安装成功

4. **如果安装失败**
   - 如果提示 `pip 不是内部或外部命令`，尝试：
     ```powershell
     python -m pip install -r requirements.txt
     ```
   - 如果提示权限错误，尝试：
     ```powershell
     pip install --user -r requirements.txt
     ```

---

## 🗄️ 第三步：安装和启动Neo4j数据库

### 3.1 下载Neo4j

1. 打开浏览器，访问：https://neo4j.com/download/
2. 下载Neo4j Desktop（推荐）或Neo4j Community Edition
3. 按照安装向导完成安装

### 3.2 启动Neo4j数据库

**使用Neo4j Desktop（推荐）：**

#### 方法一：创建新实例并启动（首次使用）

1. **打开Neo4j Desktop应用程序**

2. **创建新实例**
   - 点击右上角的蓝色 **"Create instance"** 按钮
   - 选择版本（推荐选择最新稳定版）
   - 输入实例名称（例如：`Knowledge Engineering`）
   - 点击 **"Create"** 创建实例

3. **启动DBMS（数据库管理系统）**
   - 在实例卡片上，点击 **"Start"** 按钮
   - 首次启动会要求设置密码，请设置为：`tangyudiadid0`
   - 等待启动完成，状态会从 "STOPPED" 变为 **"RUNNING"**
   - **重要**：确保看到状态显示为 **"RUNNING"**（绿色圆点）

4. **创建数据库（重要！）**
   - 在实例卡片中，展开 **"Databases"** 部分
   - 点击 **"Create database"** 按钮
   - 输入数据库名称（例如：`neo4j` 或 `medical`）
   - 点击 **"Create"** 创建数据库
   - 如果出现错误，请参考下面的"常见问题"部分

#### 方法二：使用现有实例（如果已有实例）

1. **找到你的实例**
   - 在Neo4j Desktop左侧列表中找到你的实例（例如：`Knowledge Engineering`）

2. **检查并启动DBMS**
   - 查看实例卡片上的状态
   - 如果显示 **"STOPPED"**，点击 **"Start"** 按钮
   - 等待状态变为 **"RUNNING"**（绿色圆点）

3. **创建或选择数据库**
   - 展开 **"Databases"** 部分
   - 如果显示 **"Databases (0)"**，点击 **"Create database"** 创建新数据库
   - 如果已有数据库，可以直接使用

#### ⚠️ 重要提示：实例状态 vs DBMS状态

在Neo4j Desktop中，有两个不同的概念：
- **实例（Instance）**：容器，可以包含多个数据库
- **DBMS**：数据库管理系统，需要单独启动

**常见问题：实例显示"RUNNING"但无法创建数据库**

**问题原因：**
- 实例可能显示为运行，但DBMS实际上没有启动
- 或者需要先启动DBMS，然后才能创建数据库

**解决方法：**

**方法A：通过Connect按钮启动**
1. 在实例卡片上，点击 **"Connect"** 按钮（带下拉箭头）
2. 选择 **"Open Browser"** 或 **"Open Terminal"**
3. 这会自动启动DBMS并打开连接
4. 然后返回Neo4j Desktop，再次尝试创建数据库

**方法B：停止并重新启动**
1. 如果实例显示为"RUNNING"，先点击 **"Stop"** 停止它
2. 等待状态变为 **"STOPPED"**
3. 然后点击 **"Start"** 重新启动
4. 等待状态变为 **"RUNNING"**（绿色圆点）
5. 再次尝试创建数据库

**方法C：验证DBMS是否真的运行**
1. 打开浏览器，访问：http://localhost:7474
2. 如果看到Neo4j登录界面，说明DBMS正在运行
3. 如果无法访问，说明DBMS没有启动，返回方法A或B

**方法D：检查并修复（如果以上方法都不行）**
1. 在Neo4j Desktop中，点击实例卡片右上角的 **"..."**（三个点）
2. 选择 **"Settings"** 或 **"Manage"**
3. 检查配置，确保没有错误
4. 尝试删除并重新创建实例（如果问题持续存在）

**使用Neo4j Community Edition：**
1. 打开Neo4j安装目录
2. 进入 `bin` 文件夹
3. 双击 `neo4j.bat` 启动数据库
4. 或在命令行中运行：
   ```powershell
   cd "Neo4j安装路径\bin"
   .\neo4j.bat console
   ```

### 3.3 验证Neo4j是否运行

1. 打开浏览器
2. 访问：http://localhost:7474
3. 如果看到Neo4j的登录界面，说明数据库已启动
4. 使用以下信息登录：
   - 用户名：`neo4j`
   - 密码：`tangyudiadid0`

### 3.4 如果无法连接Neo4j

- 检查Neo4j是否真的在运行（查看任务管理器）
- 确认端口7474没有被其他程序占用
- 检查防火墙设置，允许Neo4j通过防火墙

---

## 🏗️ 第四步：构建知识图谱（重要！）

### 操作步骤：

1. **确保Neo4j数据库已启动**
   - 按照第三步操作，确保Neo4j正在运行
   - 可以通过浏览器访问 http://localhost:7474 来确认

2. **打开命令行窗口**
   - 如果之前关闭了，请重新打开并切换到项目目录：
     ```powershell
     cd "E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG"
     ```

3. **运行构建脚本**
   - 在命令行中输入：
     ```powershell
     python build_medicalgraph.py
     ```
   - 按回车键执行

4. **等待构建完成**
   - 你会看到类似这样的输出：
     ```
     1
     2
     3
     ...
     正在创建节点...
     正在创建关系...
     ```
   - 这个过程可能需要几分钟到十几分钟，取决于数据量
   - **请耐心等待，不要关闭命令行窗口**

5. **验证构建是否成功**
   - 如果程序运行到最后没有报错，说明构建成功
   - 可以打开浏览器访问 http://localhost:7474
   - 在Neo4j浏览器中执行查询：`MATCH (n) RETURN count(n)`
   - 如果返回数字大于0，说明数据已导入成功

6. **如果构建失败**
   - **错误：连接Neo4j失败**
     - 检查Neo4j是否已启动（打开浏览器访问 http://localhost:7474，如果能打开说明Neo4j在运行）
     - 检查用户名和密码是否正确（默认：neo4j / tangyudiadid0）
     - **⚠️ 重要：如果修改了密码，需要同时修改代码中的密码**
     - **连接配置检查**：
       - 打开 `build_medicalgraph.py` 文件，检查第10行的连接代码
       - ✅ 正确格式：`Graph("bolt://localhost:7687", auth=("neo4j", "tangyudiadid0"))`
       - ❌ 错误格式：`Graph("http://localhost:7474", username="neo4j", password="tangyudiadid0")`
       - **注意**：必须使用 `bolt://localhost:7687`（不是 `http://localhost:7474`），且认证方式必须是 `auth=("用户名", "密码")`
   - **错误：找不到文件**
     - 确认 `data/medical2.json` 文件存在
     - 确认你在正确的目录下运行命令

---

## ✅ 第五步：测试程序（可选但推荐）

### 操作步骤：

1. **在命令行窗口中输入**
   ```powershell
   python test_import.py
   ```
   - 按回车键执行

2. **查看测试结果**
   - 如果看到类似这样的输出：
     ```
     ✓ 所有模块导入成功
     ✓ 词典文件读取成功
     测试完成！所有检查都通过了。
     ```
   - 说明测试通过，可以继续下一步

3. **如果测试失败**
   - 检查依赖是否已正确安装（返回第二步）
   - 检查词典文件是否存在

---

## 🎯 第六步：运行问答系统

### 操作步骤：

1. **确保Neo4j数据库正在运行**
   - 可以通过浏览器访问 http://localhost:7474 来确认

2. **在命令行窗口中输入**
   ```powershell
   python chatbot_graph.py
   ```
   - 按回车键执行

3. **等待程序启动**
   - 你会看到类似这样的提示：
     ```
     咨询:
     ```
   - 这表示程序已成功启动，正在等待你输入问题

4. **输入问题进行测试**
   - 在 `咨询:` 后面输入你的问题，例如：
     ```
     咨询:感冒的症状是什么？
     ```
   - 按回车键

5. **查看回答**
   - 程序会显示机器人的回答，例如：
     ```
     客服机器人: 感冒的症状包括：发热、鼻塞、流鼻涕、打喷嚏、咳嗽、头痛...
     ```

6. **继续提问**
   - 可以继续输入其他问题，例如：
     - `感冒用什么药？`
     - `发烧可能是什么病？`
     - `如何预防感冒？`
   - 每次输入问题后按回车即可

7. **退出程序**
   - 按 `Ctrl + C` 可以退出程序

---

## 📝 常见问题详细解答

### Q1: 我不知道命令行在哪里输入？

**A:** 
- 命令行就是黑色的窗口，里面有一些文字提示
- 在Windows中，按 `Win + R`，输入 `cmd` 或 `powershell`，按回车就可以打开
- 或者从项目文件夹右键选择"在此处打开命令窗口"

### Q2: 输入命令后没有反应？

**A:**
- 确认你已经按了回车键（Enter键）
- 确认命令拼写正确（可以复制粘贴避免输入错误）
- 有些命令需要时间执行，请耐心等待

### Q3: 提示"找不到文件"或"文件不存在"？

**A:**
- 确认你在正确的目录下运行命令
- 在命令行中输入 `dir`（PowerShell用 `ls`）查看当前目录的文件
- 应该能看到 `chatbot_graph.py`、`build_medicalgraph.py` 等文件
- 如果看不到，使用 `cd` 命令切换到正确的目录

### Q4: 提示"python 不是内部或外部命令"？

**A:**
- 说明Python没有添加到系统路径，或者没有安装
- 尝试使用完整路径，例如：`C:\Python38\python.exe build_medicalgraph.py`
- 或者重新安装Python，并勾选"Add Python to PATH"选项

### Q5: 提示"ModuleNotFoundError"？

**A:**
- 说明依赖包没有安装
- 返回第二步，重新运行 `pip install -r requirements.txt`
- 如果还是不行，尝试：`python -m pip install -r requirements.txt`

### Q6: Neo4j连接失败？

**A:**
- 检查Neo4j是否已启动（打开Neo4j Desktop查看状态）
- 打开浏览器访问 http://localhost:7474，如果能打开说明Neo4j在运行
- 检查用户名和密码是否正确（默认：neo4j / tangyudiadid0）
- 如果修改了密码，需要同时修改代码中的密码
- **⚠️ 检查连接配置格式**：
  - 打开 `build_medicalgraph.py` 和 `answer_search.py`
  - ✅ 正确格式：`Graph("bolt://localhost:7687", auth=("neo4j", "密码"))`
  - ❌ 错误格式：`Graph("http://localhost:7474", username="neo4j", password="密码")`
  - **重要**：必须使用 `bolt://localhost:7687`（Bolt协议），不能用 `http://localhost:7474`（HTTP协议仅用于浏览器）

### Q7: 创建数据库时提示"Cannot connect to stopped DBMS"，或点击Connect → Query后连接失败？

**A:** 这是最常见的问题！虽然实例显示"RUNNING"，但DBMS可能没有真正启动。

**⚠️ 如果你点击Connect → Query后出现错误：**
- 错误信息："Connection to Instance Failed" 或 "Could not perform discovery. No routing servers available"
- **解决方法**：不要点击Query，而是点击 **"Explore"** 或 **"Open Browser"**（它们会自动启动DBMS）

**快速解决方法（按顺序尝试）：**

1. **方法一：通过Connect按钮启动（最简单）**
   - 在Neo4j Desktop中，找到你的实例（例如：`Knowledge Engineering`）
   - 点击实例卡片上的 **"Connect"** 按钮（带下拉箭头）
   - **重要**：选择 **"Explore"** 或 **"Open Browser"**（不要选Query）
   - 这会自动启动DBMS并打开浏览器
   - 等待浏览器成功打开后，返回Neo4j Desktop，再次尝试创建数据库或点击Query

2. **方法二：停止并重新启动**
   - 在实例卡片上，点击 **"Stop"** 按钮（如果显示RUNNING）
   - 等待状态变为 **"STOPPED"**
   - 然后点击 **"Start"** 重新启动
   - 等待状态变为 **"RUNNING"**（绿色圆点）
   - 再次尝试创建数据库

3. **方法三：验证DBMS是否真的运行**
   - 打开浏览器，访问：http://localhost:7474
   - 如果看到Neo4j登录界面，说明DBMS正在运行
   - 如果显示"无法访问此网站"，说明DBMS没有启动，使用方法一或二

**💡 小技巧：**
- Query 选项需要DBMS已经运行才能连接
- Explore/Browser 选项会自动启动DBMS（如果还没运行）
- 所以如果DBMS没运行，先点击Explore或Browser，等启动后再用Query

**为什么会出现这个问题？**
- Neo4j Desktop中的"实例"和"DBMS"是两个不同的概念
- 实例可能显示为运行，但DBMS（数据库管理系统）需要单独启动
- 创建数据库需要DBMS运行，而不仅仅是实例运行

### Q8: 构建知识图谱时很慢？

**A:**
- 这是正常的，数据量大的话可能需要几分钟到十几分钟
- 请耐心等待，不要关闭命令行窗口
- 如果超过30分钟还没完成，可能是出错了，检查是否有错误提示

### Q9: 如何知道程序是否在运行？

**A:**
- 如果命令行窗口还在显示内容，说明程序在运行
- 如果窗口卡住不动，可能是正在处理，请等待
- 如果出现错误信息，说明程序出错了

---

## 🔍 快速检查清单

在运行程序前，请确认：

- [ ] Python已安装（运行 `python --version` 有输出）
- [ ] 已打开命令行窗口并切换到项目目录
- [ ] 已安装依赖包（运行过 `pip install -r requirements.txt`）
- [ ] Neo4j数据库已安装并启动
- [ ] 可以通过浏览器访问 http://localhost:7474
- [ ] 已运行 `build_medicalgraph.py` 构建知识图谱（首次运行前必须）
- [ ] 当前在项目目录 `QAMedicalKG` 下

---

## 📞 需要帮助？

如果按照以上步骤操作后仍然遇到问题，请检查：

1. **Python版本**：运行 `python --version`，应该是3.6或更高版本
2. **目录位置**：运行 `cd` 确认当前目录是否正确
3. **文件存在**：运行 `dir`（或 `ls`）查看文件是否存在
4. **Neo4j状态**：在浏览器中访问 http://localhost:7474 确认数据库运行状态

---

## 🎓 示例：完整操作流程

假设你第一次使用，完整流程如下：

```
1. 打开PowerShell（Win + R，输入powershell，回车）

2. 切换到项目目录：
   cd "E:\学委\作业\大三上\知识工程\第五章：基于知识图谱的医药问答系统实战\QAMedicalKG"

3. 安装依赖：
   pip install -r requirements.txt
   （等待安装完成，看到Successfully installed）

4. 启动Neo4j数据库（打开Neo4j Desktop，点击Start）

5. 验证Neo4j运行：
   （打开浏览器访问 http://localhost:7474）

6. 构建知识图谱：
   python build_medicalgraph.py
   （等待几分钟，直到完成）

7. 测试程序（可选）：
   python test_import.py

8. 运行问答系统：
   python chatbot_graph.py

9. 输入问题：
   咨询: 感冒的症状是什么？
   （按回车，查看回答）

10. 继续提问或按Ctrl+C退出
```

---

**祝你使用愉快！** 🎉

